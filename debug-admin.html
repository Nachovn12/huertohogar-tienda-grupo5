<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Admin Panel - HuertoHogar</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        .btn { padding: 8px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .product-item { padding: 10px; border: 1px solid #eee; margin: 5px 0; background: white; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Debug Admin Panel - HuertoHogar</h1>
    
    <div class="debug-section">
        <h2>Estado del Sistema</h2>
        <div id="system-status">
            <p>Verificando estado del sistema...</p>
        </div>
        <button onclick="checkSystemStatus()" class="btn btn-info">Verificar Estado</button>
    </div>
    
    <div class="debug-section">
        <h2>Productos de Prueba</h2>
        <div id="products-list">
            <!-- Los productos se cargarán aquí -->
        </div>
        <button onclick="addTestProduct()" class="btn btn-success">Agregar Producto de Prueba</button>
        <button onclick="clearProducts()" class="btn btn-danger">Limpiar Productos</button>
    </div>
    
    <div class="debug-section">
        <h2>Prueba de Eliminación</h2>
        <div id="delete-test">
            <p>Haz clic en "Eliminar" en cualquier producto para probar la funcionalidad</p>
        </div>
    </div>
    
    <div class="debug-section">
        <h2>Papelera</h2>
        <div id="trash-list">
            <!-- Los productos eliminados se mostrarán aquí -->
        </div>
        <button onclick="clearTrash()" class="btn btn-danger">Limpiar Papelera</button>
    </div>
    
    <div class="debug-section">
        <h2>Log de Debug</h2>
        <div id="debug-log" style="background: #000; color: #0f0; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace;">
            <!-- Los logs se mostrarán aquí -->
        </div>
        <button onclick="clearLog()" class="btn btn-info">Limpiar Log</button>
    </div>

    <script>
        // Sistema de logging
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            if (type === 'error') {
                logEntry.style.color = '#f00';
            } else if (type === 'success') {
                logEntry.style.color = '#0f0';
            } else if (type === 'warning') {
                logEntry.style.color = '#ff0';
            }
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
        }
        
        // Datos de prueba
        let products = [
            { id: 1, name: "Manzanas Fuji", price: 2500, category: "Frutas Frescas", stock: 50 },
            { id: 2, name: "Espinacas Orgánicas", price: 1800, category: "Verduras Orgánicas", stock: 30 },
            { id: 3, name: "Miel Orgánica", price: 4500, category: "Productos Orgánicos", stock: 20 }
        ];
        
        let trashProducts = [];
        let nextId = 4;
        
        // Elementos del DOM
        const productsList = document.getElementById('products-list');
        const trashList = document.getElementById('trash-list');
        const systemStatus = document.getElementById('system-status');
        
        // Verificar estado del sistema
        function checkSystemStatus() {
            log('Verificando estado del sistema...');
            
            const status = {
                products: products.length,
                trash: trashProducts.length,
                localStorage: typeof(Storage) !== "undefined",
                adminPanel: typeof(window.adminPanel) !== "undefined"
            };
            
            let statusHtml = `
                <div class="status status-success">
                    <strong>Estado del Sistema:</strong><br>
                    • Productos activos: ${status.products}<br>
                    • Productos en papelera: ${status.trash}<br>
                    • localStorage disponible: ${status.localStorage ? 'Sí' : 'No'}<br>
                    • adminPanel disponible: ${status.adminPanel ? 'Sí' : 'No'}
                </div>
            `;
            
            systemStatus.innerHTML = statusHtml;
            log(`Estado verificado: ${JSON.stringify(status)}`);
        }
        
        // Renderizar productos
        function renderProducts() {
            log('Renderizando productos...');
            productsList.innerHTML = '';
            
            if (products.length === 0) {
                productsList.innerHTML = '<p>No hay productos</p>';
                return;
            }
            
            products.forEach(product => {
                const div = document.createElement('div');
                div.className = 'product-item';
                div.innerHTML = `
                    <strong>${product.name}</strong> - $${product.price} (${product.category}) - Stock: ${product.stock}
                    <button onclick="testDeleteProduct(${product.id})" class="btn btn-danger" style="float: right;">Eliminar</button>
                `;
                productsList.appendChild(div);
            });
            
            log(`Productos renderizados: ${products.length}`);
        }
        
        // Renderizar papelera
        function renderTrash() {
            log('Renderizando papelera...');
            trashList.innerHTML = '';
            
            if (trashProducts.length === 0) {
                trashList.innerHTML = '<p>Papelera vacía</p>';
                return;
            }
            
            trashProducts.forEach(product => {
                const div = document.createElement('div');
                div.className = 'product-item';
                div.innerHTML = `
                    <strong>${product.name}</strong> - $${product.price} (${product.category})
                    <button onclick="restoreProduct(${product.id})" class="btn btn-success" style="float: right;">Recuperar</button>
                `;
                trashList.appendChild(div);
            });
            
            log(`Papelera renderizada: ${trashProducts.length} productos`);
        }
        
        // Probar eliminación
        function testDeleteProduct(productId) {
            log(`Iniciando eliminación del producto ID: ${productId}`);
            
            const product = products.find(p => p.id === productId);
            if (!product) {
                log(`Error: Producto con ID ${productId} no encontrado`, 'error');
                return;
            }
            
            log(`Producto encontrado: ${product.name}`);
            
            if (confirm(`¿Estás seguro de que deseas eliminar "${product.name}"?`)) {
                log(`Confirmación recibida para eliminar: ${product.name}`);
                
                // Agregar fecha de eliminación
                product.deletedAt = new Date().toISOString();
                product.deletedBy = 'admin';
                
                // Mover a la papelera
                trashProducts.push(product);
                log(`Producto movido a la papelera: ${product.name}`);
                
                // Eliminar de la lista principal
                const index = products.findIndex(p => p.id === productId);
                products.splice(index, 1);
                log(`Producto eliminado de la lista principal: ${product.name}`);
                
                // Actualizar vistas
                renderProducts();
                renderTrash();
                
                log(`Eliminación completada exitosamente: ${product.name}`, 'success');
            } else {
                log(`Eliminación cancelada por el usuario: ${product.name}`, 'warning');
            }
        }
        
        // Recuperar producto
        function restoreProduct(productId) {
            log(`Iniciando recuperación del producto ID: ${productId}`);
            
            const index = trashProducts.findIndex(p => p.id === productId);
            if (index === -1) {
                log(`Error: Producto con ID ${productId} no encontrado en la papelera`, 'error');
                return;
            }
            
            const product = trashProducts[index];
            log(`Producto encontrado en papelera: ${product.name}`);
            
            // Remover propiedades de eliminación
            delete product.deletedAt;
            delete product.deletedBy;
            
            // Agregar de vuelta a la lista principal
            products.push(product);
            log(`Producto agregado de vuelta a la lista principal: ${product.name}`);
            
            // Remover de la papelera
            trashProducts.splice(index, 1);
            log(`Producto removido de la papelera: ${product.name}`);
            
            // Actualizar vistas
            renderProducts();
            renderTrash();
            
            log(`Recuperación completada exitosamente: ${product.name}`, 'success');
        }
        
        // Agregar producto de prueba
        function addTestProduct() {
            const newProduct = {
                id: nextId++,
                name: `Producto de Prueba ${nextId - 4}`,
                price: Math.floor(Math.random() * 5000) + 1000,
                category: "Prueba",
                stock: Math.floor(Math.random() * 100) + 1
            };
            
            products.push(newProduct);
            log(`Producto de prueba agregado: ${newProduct.name}`, 'success');
            renderProducts();
        }
        
        // Limpiar productos
        function clearProducts() {
            products = [];
            log('Productos limpiados', 'warning');
            renderProducts();
        }
        
        // Limpiar papelera
        function clearTrash() {
            trashProducts = [];
            log('Papelera limpiada', 'warning');
            renderTrash();
        }
        
        // Inicializar
        log('Inicializando sistema de debug...');
        checkSystemStatus();
        renderProducts();
        renderTrash();
        log('Sistema de debug inicializado correctamente', 'success');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - HuertoHogar</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="assets/favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/favicon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/favicon/favicon-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
    <link rel="manifest" href="assets/favicon/site.webmanifest">
    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/normalizar.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/panel-administrador.css">
</head>
<body>
    <!-- Barra de información superior -->
    <div class="top-info-bar">
        <div class="top-info-content">
            <div class="info-left">
                <span><i class="fas fa-truck"></i> Despacho gratis desde $15.000</span>
                <span><i class="fas fa-clock"></i> Lunes a Sábado 9:00 - 19:00</span>
            </div>
            <div class="info-right">
                <span><i class="fas fa-phone"></i> +56 9 1234 5678</span>
                <span><i class="fas fa-envelope"></i> contacto@huertohogar.cl</span>
            </div>
        </div>
    </div>
    <header class="main-header">
        <div class="header-content">
            <a href="index.html" class="logo-container">
                <img src="assets/img/Logo Huerto Hogar.jpg" alt="Logo de HuertoHogar" class="logo">
                <h2>HuertoHogar</h2>
            </a>
            <nav class="main-nav">
                <a href="index.html">Inicio</a>
                <a href="productos.html">Productos</a>
                <a href="nosotros.html">Nosotros</a>
                <a href="blog.html">Blog</a>
            </nav>
            <div class="header-actions">
                <a href="login.html" class="login-link" id="user-login-link" style="display: none;">Ingresar</a>
                <div class="user-profile" id="user-profile">
                    <span class="user-name" id="user-name">Administrador</span>
                    <div class="user-menu">
                        <a href="panel-administrador.html" class="user-menu-item">
                            <i class="fas fa-cog"></i>
                            Panel Admin
                        </a>
                        <button id="logout-btn" class="user-menu-item logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Modal de Login de Administrador ELIMINADO - Ahora se usa login.html -->
    <main class="admin-main" id="admin-main-content">
        <!-- Header del Panel de Administración -->
        <section class="admin-header">
            <div class="admin-header-content">
                <div class="admin-title-section">
                    <h1 class="admin-title">
                        <i class="fas fa-seedling"></i>
                        Panel de Administración
                    </h1>
                    <p class="admin-subtitle">Gestiona los productos de HuertoHogar</p>
                </div>
                <div class="admin-actions">
                    <button id="add-product-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Agregar Producto
                    </button>
                    <button id="refresh-products-btn" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar
                    </button>
                </div>
            </div>
        </section>
        <!-- Estadísticas del Panel -->
        <section class="admin-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-products">0</h3>
                        <p>Total Productos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-categories">0</h3>
                        <p>Categorías</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="avg-price">$0</h3>
                        <p>Precio Promedio</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="featured-products">0</h3>
                        <p>Productos Destacados</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Filtros y Búsqueda -->
        <section class="admin-filters">
            <div class="filters-container">
                <div class="search-section">
                    <div class="search-input-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="admin-search" placeholder="Buscar productos...">
                    </div>
                </div>
                <div class="filter-section">
                    <select id="category-filter" class="filter-select">
                        <option value="">Todas las categorías</option>
                    </select>
                    <select id="status-filter" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="active">Activos</option>
                        <option value="inactive">Inactivos</option>
                    </select>
                    <button id="clear-filters" class="btn btn-outline">
                        <i class="fas fa-times"></i>
                        Limpiar Filtros
                    </button>
                </div>
            </div>
        </section>
        <!-- Tabla de Productos -->
        <section class="admin-products">
            <div class="products-container">
                <div class="products-header">
                    <h2>Lista de Productos</h2>
                <div class="products-actions">
                    <button id="view-trash-btn" class="btn btn-outline">
                        <i class="fas fa-trash"></i>
                        Papelera (<span id="trash-count">0</span>)
                    </button>
                    <button id="export-products" class="btn btn-outline">
                        <i class="fas fa-download"></i>
                        Exportar
                    </button>
                    <button id="import-products" class="btn btn-outline">
                        <i class="fas fa-upload"></i>
                        Importar
                    </button>
                </div>
                </div>
                <div class="products-table-container">
                    <table class="products-table" id="products-table">
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Nombre</th>
                                <th>Categoría</th>
                                <th>Precio</th>
                                <th>Stock</th>
                                <th>Estado</th>
                                <th>Destacado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <!-- Los productos se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
                <div class="products-pagination" id="products-pagination">
                    <!-- La paginación se generará dinámicamente -->
                </div>
            </div>
        </section>
    </main>
    <!-- Modal para Agregar/Editar Producto -->
    <div id="product-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modal-title">Agregar Producto</h2>
                <button class="close-btn" id="close-modal">×</button>
            </div>
            <div class="modal-body">
                <form id="product-form" class="product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">Nombre del Producto *</label>
                            <input type="text" id="product-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="product-category">Categoría *</label>
                            <select id="product-category" name="category" required>
                                <option value="">Seleccionar categoría</option>
                                <option value="Frutas Frescas">Frutas Frescas</option>
                                <option value="Verduras Orgánicas">Verduras Orgánicas</option>
                                <option value="Productos Orgánicos">Productos Orgánicos</option>
                                <option value="Productos Lácteos">Productos Lácteos</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-price">Precio (CLP) *</label>
                            <input type="number" id="product-price" name="price" min="0" step="100" required>
                        </div>
                        <div class="form-group">
                            <label for="product-stock">Stock *</label>
                            <input type="number" id="product-stock" name="stock" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-image">URL de la Imagen *</label>
                            <input type="url" id="product-image" name="image" required>
                        </div>
                        <div class="form-group">
                            <label for="product-unit">Unidad de Medida</label>
                            <select id="product-unit" name="unit">
                                <option value="kg">Kilogramo (kg)</option>
                                <option value="g">Gramo (g)</option>
                                <option value="unidad">Unidad</option>
                                <option value="litro">Litro (L)</option>
                                <option value="ml">Mililitro (ml)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Descripción</label>
                        <textarea id="product-description" name="description" rows="4" placeholder="Describe las características del producto..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-features">Características (separadas por comas)</label>
                        <input type="text" id="product-features" name="features" placeholder="Ej: Orgánico, Fresco, De temporada">
                    </div>
                    <div class="form-row">
                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="product-featured" name="featured">
                                <span class="checkmark"></span>
                                Producto destacado
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="product-active" name="active" checked>
                                <span class="checkmark"></span>
                                Producto activo
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-product">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="save-product">
                            <span class="btn-text">Guardar Producto</span>
                            <span class="btn-loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                                Guardando...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal de Confirmación de Eliminación -->
    <div id="delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container delete-modal">
            <div class="modal-header">
                <h2>Confirmar Eliminación</h2>
                <button class="close-btn" id="close-delete-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>¿Estás seguro de que deseas eliminar este producto?</p>
                    <p class="delete-product-name" id="delete-product-name"></p>
                    <p class="delete-warning-text">Esta acción no se puede deshacer.</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-delete">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete">
                        <i class="fas fa-trash"></i>
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Papelera -->
    <div id="trash-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container trash-modal">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-trash"></i>
                    Papelera de Productos
                </h2>
                <button class="close-btn" id="close-trash-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="trash-info">
                    <p>Productos eliminados recientemente. Puedes recuperarlos o eliminarlos permanentemente.</p>
                </div>
                <div class="trash-actions">
                    <button id="restore-all-btn" class="btn btn-success" disabled>
                        <i class="fas fa-undo"></i>
                        Recuperar Todo
                    </button>
                    <button id="delete-all-btn" class="btn btn-danger" disabled>
                        <i class="fas fa-trash"></i>
                        Eliminar Todo Permanentemente
                    </button>
                </div>
                <div class="trash-table-container">
                    <table class="trash-table" id="trash-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="select-all-trash">
                                </th>
                                <th>Imagen</th>
                                <th>Nombre</th>
                                <th>Categoría</th>
                                <th>Precio</th>
                                <th>Eliminado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="trash-tbody">
                            <!-- Los productos eliminados se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
                <div class="trash-empty" id="trash-empty" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-trash-alt"></i>
                        <h3>Papelera Vacía</h3>
                        <p>No hay productos eliminados</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Input oculto para importar archivos -->
    <input type="file" id="import-file-input" accept=".json" style="display: none;">
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>HuertoHogar</h4>
                <p>Conectando el campo chileno con tu mesa. Frescura, calidad y sostenibilidad en cada entrega.</p>
            </div>
            <div class="footer-section">
                <h4>Navegación</h4>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="panel-administrador.html">Panel Admin</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Síguenos</h4>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
        <p class="footer-bottom">© 2025 HuertoHogar. Todos los derechos reservados.</p>
    </footer>
    <!-- Script de protección de sesión de administrador - DEBE EJECUTARSE PRIMERO -->
    <script src="assets/js/proteccion-sesion-admin.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/autenticacion-mejorada.js"></script>
    <script src="assets/js/panel-administrador.js"></script>
    <script>
        // Verificar permisos de administrador al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const isAdmin = localStorage.getItem('huertohogar_is_admin') === 'true';
            const userRole = localStorage.getItem('huertohogar_user_role');
            if (!isAdmin || userRole !== 'admin') {
                alert('Acceso denegado. Necesitas permisos de administrador.');
                window.location.href = 'login.html';
                return;
            }
                // Configurar logout desde el header
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        // Usar función de limpieza autorizada si existe
                        if (typeof window.clearAdminSession === 'function') {
                            window.clearAdminSession();
                        } else {
                            // Fallback: limpiar manualmente
                            localStorage.removeItem('huertohogar_is_admin');
                            localStorage.removeItem('huertohogar_user_role');
                            localStorage.removeItem('huertoHogarAuth');
                        }
                        // Redirigir al login
                        window.location.href = 'login.html';
                    });
                }
        });
    </script>
</body>
</html>
